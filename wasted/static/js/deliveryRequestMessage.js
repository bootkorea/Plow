var DeliveryRequestMessage=function(options){var controller={element:options.element,ui:{messageWrap:".delivery-request-message__input-wrap",messageSelect:".delivery-request-message__select",messageInput:".delivery-request-message__input",messageDesc:".delivery-request-message__desc",messageCurrentLength:".delivery-request-message__current-length",messageMaxLength:".delivery-request-message__max-length",messageForm:".delivery-request-message-form",validateMessage:".validate-message",extraCheckbox:".extra-delivery-request-message__checkbox",
extraTitle:".extra-delivery-request-message__title",extraLabel:".extra-delivery-request-message__label",extraDescription:".extra-delivery-request-message__description-value",extraInput:".extra-delivery-request-message__input",extraCurrentLength:".extra-delivery-request-message__current-length",extraMaxLength:".extra-delivery-request-message__max-length",extraForm:".extra-delivery-request-message-form"},messages:{TRY_AGAIN:Pacifik.formatMessage("checkout.91c5e1","특수 기호를 빼고 다시한번 입력해 주세요."),REQUIREMENT_ROCKERPASSWORD:Pacifik.formatMessage("checkout.a0992d",
"[필수] 택배함 비밀번호를 넣어주세요."),extra:{house:{title:Pacifik.formatMessage("checkout.ac9049","공동현관문 비밀번호 입력"),desc:Pacifik.formatMessage("checkout.ca31d5","쿠팡맨 배송 시에만 사용됩니다.")},locker:{title:Pacifik.formatMessage("checkout.0d8bfc","택배함 비밀번호 또는 휴대폰 번호 입력"),desc:Pacifik.formatMessage("checkout.ca31d5","쿠팡맨 배송 시에만 사용됩니다."),placeholder:Pacifik.formatMessage("checkout.7968aa","택배함 비밀번호 (필수)"),isRequirement:true},input:{title:"",desc:'\x3cspan class\x3d"warning"\x3e'+Pacfik.formatMessage("checkout.323cb2","* 장소만 저장되며 소화전/EPS/TPS등은 안전상 보관 불가 합니다.")+
"\x3c/span\x3e"}}},deliveryRequestMessage:"",deliveryRequestAddMessage:"",extraDeliveryRequestMessage:"",initialize:function(){utility.uiEnhancements.call(this);this._addEventListener();this._bindAdditionalMessage()},_addEventListener:function(){this.element.off().on("change",this.ui.__uiString.messageSelect,$.proxy(this._selectMessageHandler,this)).on("keyup",this.ui.__uiString.messageInput,$.proxy(this._insertMessageHandler,this))},_bindAdditionalMessage:function(){this.ui.extraCheckbox.bind("change",
$.proxy(function(e){this.ui.extraInput.val("");if($(e.target).prop("checked"))this.ui.extraForm.show();else this.ui.extraForm.hide()},this));this.ui.extraInput.bind("input",$.proxy(function(e){var $message=$(e.currentTarget);var message=$message.val();var currentLength=message.length;this.extraDeliveryRequestMessage=message;this.ui.extraCurrentLength.text(currentLength);this.validate()},this))},_selectMessageHandler:function(event){this.deliveryRequestMessage=$(event.currentTarget).val();var options=
$(event.currentTarget).children("option"),index=options.index(options.filter(":selected")),type=options.eq(index).data("extratype")||"";this.ui.messageForm.hide();this.ui.extraForm.hide();this.ui.extraCheckbox.prop("checked",false);this.ui.messageInput.val("");this.ui.extraInput.val("");this.ui.extraInput.data("requirement",false);this.ui.validateMessage.hide();if(type==="input"){$(this.ui.messageWrap).removeClass("extra");this.ui.messageForm.show();this.ui.messageDesc.html(this.messages.extra[type].desc||
"")}else if(type!=="")this._extraMessage(type);else $(this.ui.messageWrap).removeClass("extra")},_insertMessageHandler:function(event){var $message=$(event.currentTarget);var message=$message.val();var currentLength=message.length;this.deliveryRequestAddMessage=message;this.ui.messageCurrentLength.text(currentLength);this.validate()},_extraMessage:function(type){var messageSet=this.messages.extra[type];this.ui.extraInput.attr("placeholder","");this.ui.extraLabel.css("display","");$(this.ui.messageWrap).addClass("extra");
this.ui.extraTitle.text(messageSet.title);this.ui.extraDescription.text(messageSet.desc);if(messageSet.isRequirement){this.ui.extraForm.show();this.ui.extraLabel.css("display","none");this.ui.extraCheckbox.prop("checked",true);this.ui.extraInput.data("requirement",true)}if(messageSet.placeholder)this.ui.extraInput.attr("placeholder",messageSet.placeholder)},validate:function(){var validateResult=this.isValidate();var result=validate.displayValidate(validateResult==="",this.ui.messageInput,this.ui.validateMessage,
validateResult);if(!result){window.alert(validateResult);$.scrollTo(this.ui.messageWrap.offset().top,400)}return result},isValidate:function(){var isCharacterValidate=validate.characters(this.ui.messageInput.val());var extraInput=this.ui.extraInput;if(!isCharacterValidate)return this.messages.TRY_AGAIN;else if(extraInput.data("requirement")&&!extraInput.val())return this.messages.REQUIREMENT_ROCKERPASSWORD;else return""},setSubmitData:function(){var data={deliveryMsg:$.trim(this.ui.messageSelect.val()+
" "+this.ui.messageInput.val()),deliveryExtraMsg:this.ui.extraCheckbox.prop("checked")?$.trim(this.ui.extraInput.val()):""};return data}};controller.initialize();return{validate:function(){try{return controller.validate()}catch(e){if(window.jslog&&window.jslog.report){window.jslog.report("배송요청메세지 영역 validate 호출시 에러가 발생했습니다.");window.jslog.report(e)}return true}},setSubmitData:function(){try{return controller.setSubmitData()}catch(e){if(window.jslog&&window.jslog.report){window.jslog.report("배송요청메세지 영역 setSubmitData 호출시 에러가 발생했습니다.");
window.jslog.report(e)}return true}}}};