!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):(e="undefined"!=typeof globalThis?globalThis:e||self).CoupangSeoWebLog=a()}(this,(function(){"use strict";var e,a,o;!function(e){e.production="production",e.development="development"}(e||(e={})),function(e){e.SRP="SRP",e.PLP="PLP",e.SDP="SDP",e.GW="GW",e.SHOP="SHOP",e.PAGE="PAGE"}(a||(a={})),function(e){e.PCWeb="web",e.MWeb="mweb"}(o||(o={}));const n={enabled:!0,platform:o.PCWeb,cookieEnabled:!1,sdkVersion:"0.0.1-beta.6",sources:[{name:"Google",referrer:[".google."],campaign:{spec:"10917115",src:"4502016"}},{name:"Naver",referrer:["naver.com","search.naver.com","m.search.naver.com","m.naver.com"],exclude:["adcr.naver.com"],campaign:{spec:"10917115",src:"4502001"}},{name:"Daum",referrer:[".daum."],campaign:{spec:"10917115",src:"4502002"}},{name:"Bing",referrer:[".bing."],campaign:{spec:"10917115",src:"4502888"}},{name:"Yahoo",referrer:[".yahoo."],campaign:{spec:"10917115",src:"4503887"}}],paths:[{page:"SDP",pattern:["www.coupang.com/vp/products"],addtag:"400"},{page:"PLP",pattern:["www.coupang.com/np/categories","www.coupang.com/np/campaigns","www.coupang.com/np/coupangglobal"],addtag:"300"},{page:"GW",pattern:["^https://www.coupang.com/$"],addtag:"900"},{page:"SRP",pattern:["www.coupang.com/np/search"],addtag:"200"},{page:"SHOP",pattern:["https://shop.coupang.com/.+"],addtag:"700"},{page:"PAGE",pattern:["https://pages.coupang.com/p/.+"],addtag:"26"}]},t={enabled:!0,platform:o.MWeb,cookieEnabled:!1,sdkVersion:"0.0.1-beta.6",sources:[{name:"Google",referrer:[".google."],campaign:{spec:"10917115",src:"4503016"}},{name:"Naver",referrer:["naver.com","search.naver.com","m.search.naver.com","m.naver.com"],exclude:["adcr.naver.com"],campaign:{spec:"10917115",src:"4503001"}},{name:"Daum",referrer:[".daum."],campaign:{spec:"10917115",src:"4503002"}},{name:"Bing",referrer:[".bing."],campaign:{spec:"10917115",src:"4503888"}},{name:"Yahoo",referrer:[".yahoo."],campaign:{spec:"10917115",src:"4502887"}}],paths:[{page:"SDP",pattern:["m.coupang.com/vm/products"],addtag:"400"},{page:"PLP",pattern:["m.coupang.com/nm/plp"],addtag:"300"},{page:"GW",pattern:["^https://m.coupang.com/$"],addtag:"900"},{page:"SRP",pattern:["m.coupang.com/nm/search"],addtag:"200"},{page:"SHOP",pattern:["^https://shop.coupang.com/.+"],addtag:"700"},{page:"PAGE",pattern:["https://pages.coupang.com/m/.+"],addtag:"26"}]},r={[o.PCWeb]:n,[o.MWeb]:t};var c={getCookie(e){let a;const o=e+"=",n=decodeURIComponent(document.cookie).split(";");for(a=0;a<n.length;a++){let e=n[a];for(;" "===e.charAt(0);)e=e.substring(1);if(0===e.indexOf(o))return e.substring(o.length,e.length)}return""},setCookie(e,a,o,n,t,r){const c=new Date(2100,1,1),i=(e=>{const a=e.split(".");return 3!==a.length&&4!==a.length?e:e.replace(/^(?:[\w\d]+\.)?([^:/]*).*$/i,"$1")})(decodeURIComponent(document.domain)),s=[];s.push(`${e}=${encodeURIComponent(a)}`),s.push(`; expires=${o&&o.toUTCString()||c.toUTCString()}`),s.push(`; domain=${n||i}`),s.push(`; path=${t||"/"}`),s.push(r&&"; secure"),document.cookie=s.join("")}},i={COOKIE:{PCID:"PCID",MEMBERSRL:"member_srl",ISAPP:"ISAPP",CAMPAIGN:["trac_src","trac_spec","trac_addtag","trac_ctag","trac_lptag"]}},s={getCampaignParameter(){const e={};return i.COOKIE.CAMPAIGN.map((a=>{const o=a.replace(/^trac_/,""),n=c.getCookie(a).replace(/"/g,"");e[o]="0"!==n&&n||""})),e.src&&e.spec&&{campaign:e}||{}},setCampaignParameter(e){i.COOKIE.CAMPAIGN.map((a=>{const o=a.replace(/^trac_/,""),n=e[o]||"";c.setCookie(a,n)}))}};const g=(e,a,o,n)=>{let t="";return t+=`%c[${e}/${a}]`,t+=` :  ${o}`,{message:t,color:n=`color: ${n};`}};var p={isDebugEnabled:!1,setDebugMode:function(){this.isDebugEnabled=!0},d:function(e,a){if(window?.console&&this.isDebugEnabled){const o=g("Debug",e,a,"purple");o.color?console.log(o.message,o.color):console.log(o.message)}},i:function(e,a){if(window?.console&&this.isDebugEnabled){const o=g("Info",e,a,"green");o.color?console.info(o.message,o.color):console.info(o.message)}},w:function(e,a){if(window?.console&&this.isDebugEnabled){const o=g("Warn",e,a,"orange");o.color?console.warn(o.message,o.color):console.warn(o.message)}},e:function(e,a){if(window?.console&&this.isDebugEnabled){const o=g("Error",e,a,"red");o.color?console.error(o.message,o.color):console.error(o.message)}}};const m="SEOWebLog",d="data-seo-rule",u="data-mode";return new class{campaignParameter;constructor(){if(window.CoupangSeoWebLog)return;if(!window.CoupangWebLog)return p.setDebugMode(),void p.w(m,"#constructor - Not found window.CoupangWebLog(#coupang-web-log) for initialize");const a=document.getElementById("seo-js-sdk");if(a){"production"!==(a.getAttribute(u)||"production")&&p.setDebugMode();const o={seoRule:JSON.parse(a.getAttribute(d))||undefined,mode:a.getAttribute(u)||e.production};p.d(m,"#constructor - use custom attribute(data-mode, data-seo-rule) for initialize"),this.init(o)}else p.d(m,"#constructor - Not found script tag(#seo-js-sdk) for initialize")}refactorInitData(e){const{cookieEnabled:a,sources:o,paths:n}=(t=e?.seoRule?.platform,r[t]);var t;return{...e,seoRule:{cookieEnabled:a,sources:o,paths:n,...e?.seoRule}}}init(a){p.d(m,`#init -\n${JSON.stringify(a,undefined,2)}`);const o=this.refactorInitData(a),n=this.getEffectiveTrafficData(o);if(n){const{path:a,source:t}=n;p.d(m,`#init - Effective SEO Traffic: Source name: ${t?.name}  Path page: ${a?.page}`);const r={meta:{schemaId:o?.mode===e.production?14506:8261,schemaVersion:1},data:{logCategory:"campaign",logType:"landing",domain:"SEO",pageName:a?.page||"",eventName:"seo_traffic_landing",page:a?.page||"",source:t?.name||"",landingUrl:window.location?.href,referrerUrl:window.document.referrer}},c=o?.seoRule?.cookieEnabled,i={...t?.campaign,addtag:a?.addtag,...this.getCTag(a)};c&&(this.rewriteCampaignCookie(i),p.d(m,"#init - Campaign cookie has been rewritten")),p.d(m,`#init - Cookie CampaignParameter \n${JSON.stringify(s.getCampaignParameter(),undefined,2)}`),p.d(m,`#init - Before rewrite WebLog CampaignParameter \n${JSON.stringify(window.CoupangWebLog.campaignParameter,undefined,2)}`),this.rewirteWebLogCampaignParameter(i),p.d(m,`#init - After rewrite WebLog CampaignParameter \n${JSON.stringify(window.CoupangWebLog.campaignParameter,undefined,2)}`),window.CoupangWebLog?.submit(r),p.d(m,"#init - SEO log has been sent."),c||(this.resetWebLogCampaignParameter(),p.d(m,`#init - After reset WebLog CampaignParameter \n${JSON.stringify(window.CoupangWebLog.campaignParameter,undefined,2)}`))}else p.d(m,"#init - Uneffective SEO Traffic");return this}getCTag(e){if(e?.page===a.SRP){const e=new URLSearchParams(window.location?.search),a=e?.get("q");return{ctag:a,lptag:a}}if(e?.page===a.PLP){const e="/np/coupangglobal"===window.location.pathname?"coupangglobal":/(nm\/plp|np\/categories|np\/campaigns)\/([0-9]*)/.exec(window.location.pathname)?.[2];return{ctag:e,lptag:e}}if(e?.page===a.SDP){const e=/v[p|m]\/products\/(quick-view\/){0,}([0-9]*)/.exec(window.location.pathname)?.[2];return{ctag:e,lptag:e}}if(e?.page===a.GW)return{ctag:"home",lptag:"coupang"};if(e?.page===a.SHOP){const e=window.__NUXT__?.state?.store?.vendorId||"";return{ctag:e,lptag:e}}if(e?.page===a.PAGE){const e=/[p|m]\/([0-9]*)/.exec(window.location.pathname)?.[1];return{ctag:e,lptag:e}}return{ctag:"",lptag:""}}getEffectiveTrafficData(e){if(this.isRobot()||this.isExclude())return;const a=this.getSeoSourceByReferrer(e);if(!a)return;const o=this.getSeoPathByUrl(e);return o?{source:a,path:o}:void 0}isRobot(){const e=window.navigator.userAgent;return/bot|googlebot|crawler|spider|robot|crawling/i.test(e)}isExclude(){const e=new URLSearchParams(window.location?.search);if(["src","spec","addtag","lptag","ctag"].some((a=>e.has(a))))return!0}getSeoSourceByReferrer(e){const a=window.document.referrer;if(!a||!function(e){try{return new URL(e),!0}catch(a){return!1}}(a))return;const o=new URL(a),n=e?.seoRule?.sources?.find((e=>e.referrer.some((e=>o?.host?.includes(e)))&&!e.exclude?.some((e=>o?.host?.includes(e)))));return n}getSeoPathByUrl(e){const{protocol:a,hostname:o,pathname:n}=window.location,t=`${a}//${o}${n}`,r=e?.seoRule?.paths?.find((e=>e.pattern?.some((e=>t.match(new RegExp(e))))));return r}rewriteCampaignCookie(e){s.setCampaignParameter(e)}rewirteWebLogCampaignParameter(e){this.campaignParameter=window.CoupangWebLog.campaignParameter,window.CoupangWebLog.campaignParameter={...window.CoupangWebLog.campaignParameter,campaign:{...window.CoupangWebLog.campaignParameter?.campaign,...e}}}resetWebLogCampaignParameter(){window.CoupangWebLog.campaignParameter=this.campaignParameter,this.campaignParameter=null}}}));
//# sourceMappingURL=seo-js-sdk.umd.min.js.map
